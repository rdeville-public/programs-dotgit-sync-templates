---
# Trigger my other repos depending on dotgit-sync to update themselves
Trigger DGS Child Repos:
  stage: post-ci
  parallel:
    matrix:
      - namespace: rdeville-public/programs
        repos:
          - dotgit-sync
      - namespace: rdeville-public/dotfiles
        repos:
          - awesome
          - direnv
          - neovim
          - nixos-config
          - shell
          - tmux
      - namespace: rdeville-private/dotfiles
        repos:
          - direnv-data
          - myrepos-data
          - nixos-data
          - tmux-data
  trigger:
    project: ${namespace}/${repos}
  rules:
      # Do Not run when called from upstream CI as its DGS template update
    - if: $CI_PIPELINE_SOURCE =~ /(parent_pipeline|pipeline)/
      when: never
      # Only run on main branch
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
    - when: never

# Trigger itself to run dotgit-sync update
Trigger DGS Itself:
  stage: post-ci
  trigger:
    include: .gitlab-ci.yml
  rules:
      # Do Not run when called from upstream CI as its DGS template update
    - if: $CI_PIPELINE_SOURCE =~ /(parent_pipeline|pipeline)/
      when: never
      # Only run on main branch
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
    - when: never
